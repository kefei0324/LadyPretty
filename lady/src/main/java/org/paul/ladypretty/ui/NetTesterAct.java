package org.paul.ladypretty.ui;

import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.view.View;
import android.widget.TextView;
import com.google.gson.Gson;
import org.paul.ladypretty.BuildConfig;
import org.paul.ladypretty.R;
import org.paul.ladypretty.bean.BroadbandlinesBean;
import org.paul.ladypretty.bean.Login;
import org.paul.ladypretty.bean.RegionList;
import org.paul.ladypretty.bean.UnReadMsg;
import org.paul.lib.base.BaseAct;
import org.paul.lib.base.Constants;
import org.paul.lib.manager.SPManager;
import org.paul.lib.manager.ThreadManager;

import java.util.HashMap;
import java.util.Map;

public class NetTesterAct extends BaseAct implements View.OnClickListener {
    private static final int EMPTY_RESPONSE = 0x10;
    private static final int UNREAD_MSG = 0x11;
    private static final int REGION_LIST = 0x13;
    private static final int LOGIN = 0x14;

    private TextView tv;

    @Override
    protected int getLayoutId(Bundle savedInstanceState) {
        return R.layout.act_nettester;
    }

    private Handler handler = new Handler() {
        @Override
        public void handleMessage(Message msg) {
            String spec = "";
            switch (msg.what) {
                case UNREAD_MSG:
                    spec = ((UnReadMsg) msg.obj).toString();
                    tv.setText(spec);
                    break;
                case EMPTY_RESPONSE:
                    tv.setText(R.string.empty);
                    break;
                case LOGIN:
                    Login login = (Login) msg.obj;
                    spec = login.toString();
                    tv.setText(spec);
                    if (login.getCode() == 1) {
                        SPManager.setString(NetTesterAct.this, "token", login.getData().getToken().getTid());
                        Constants.setTOKEN(login.getData().getToken().getTid());
                    }
                    break;
                case REGION_LIST:
                    spec = ((RegionList) msg.obj).toString();
                    tv.setText(spec);
                    break;
            }
        }
    };

    @Override
    protected void bindUi() {

        $(R.id.btn).setOnClickListener(this);
        $(R.id.btn_2).setOnClickListener(this);
        $(R.id.btn_3).setOnClickListener(this);
        $(R.id.btn_4).setOnClickListener(this);
        tv = $(R.id.tv);

    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.btn:
                request();
                break;
            case R.id.btn_2:
                requestRegion();
                break;
            case R.id.btn_3:
                requestLogin();
                break;
            case R.id.btn_4:
                requestBroadLine();
                break;
        }
    }

    private void requestBroadLine() {
        String ret ="{\n" +
                "    \"code\": 0,\n" +
                "    \"message\": \"success\",\n" +
                "    \"data\": {\n" +
                "        \"customerId\": \"00a20204-6666-4232-a064-2f0b72ff0111\",\n" +
                "        \"lineCount\": 1,\n" +
                "        \"dataCount\": 48,\n" +
                "        \"broadBandLinePerformance\": {\n" +
                "            \"lineId\": \"20170912001\",\n" +
                "            \"offeringId\": \"2017000009\",\n" +
                "            \"subscriberName\": \"tsim sha tsui - branch\",\n" +
                "            \"lineAddress\": \"tsim sha tsui - branch\",\n" +
                "            \"lineCoordinate\": \"114.1721746,22.2988123\",\n" +
                "            \"bandWidth\": 100,\n" +
                "            \"effDate\": 1505772000000,\n" +
                "            \"expDate\": 1537308000000,\n" +
                "            \"upLinkTraffics\": {\n" +
                "                \"1515772800000\": 25762.8,\n" +
                "                \"1515774600000\": 22608.8,\n" +
                "                \"1515776400000\": 43032.1,\n" +
                "                \"1515778200000\": 96469.9,\n" +
                "                \"1515780000000\": 92214.3,\n" +
                "                \"1515781800000\": 118.6,\n" +
                "                \"1515783600000\": 24139.3,\n" +
                "                \"1515785400000\": 57005.1,\n" +
                "                \"1515787200000\": 94308.2,\n" +
                "                \"1515789000000\": 9172.1,\n" +
                "                \"1515790800000\": 16658.5,\n" +
                "                \"1515792600000\": 12198.1,\n" +
                "                \"1515794400000\": 27234.1,\n" +
                "                \"1515796200000\": 64294.4,\n" +
                "                \"1515798000000\": 13897.4,\n" +
                "                \"1515799800000\": 7770.4,\n" +
                "                \"1515801600000\": 72223,\n" +
                "                \"1515803400000\": 37277.9,\n" +
                "                \"1515805200000\": 61095,\n" +
                "                \"1515807000000\": 4807.4,\n" +
                "                \"1515808800000\": 54280.4,\n" +
                "                \"1515810600000\": 26355.2,\n" +
                "                \"1515812400000\": 16380.7,\n" +
                "                \"1515814200000\": 69491,\n" +
                "                \"1515816000000\": 73070.8,\n" +
                "                \"1515817800000\": 34753.4,\n" +
                "                \"1515819600000\": 96407.4,\n" +
                "                \"1515821400000\": 36861.6,\n" +
                "                \"1515823200000\": 86249.3,\n" +
                "                \"1515825000000\": 44176,\n" +
                "                \"1515826800000\": 98455.8,\n" +
                "                \"1515828600000\": 46656.8,\n" +
                "                \"1515830400000\": 49537.2,\n" +
                "                \"1515832200000\": 93759.6,\n" +
                "                \"1515834000000\": 15806.5,\n" +
                "                \"1515835800000\": 74273.7,\n" +
                "                \"1515837600000\": 42839.6,\n" +
                "                \"1515839400000\": 52.8,\n" +
                "                \"1515841200000\": 88176.2,\n" +
                "                \"1515843000000\": 4900.1,\n" +
                "                \"1515844800000\": 36700.4,\n" +
                "                \"1515846600000\": 78563.5,\n" +
                "                \"1515848400000\": 54016.7,\n" +
                "                \"1515850200000\": 23864.4,\n" +
                "                \"1515852000000\": 78393.2,\n" +
                "                \"1515853800000\": 52421.2,\n" +
                "                \"1515855600000\": 96470.9\n" +
                "            },\n" +
                "            \"downLinkTraffics\": {\n" +
                "                \"1515772800000\": 51537.9,\n" +
                "                \"1515774600000\": 80715.6,\n" +
                "                \"1515776400000\": 62435.1,\n" +
                "                \"1515778200000\": 78870.6,\n" +
                "                \"1515780000000\": 63650,\n" +
                "                \"1515781800000\": 98238.9,\n" +
                "                \"1515783600000\": 22158.5,\n" +
                "                \"1515785400000\": 8068.8,\n" +
                "                \"1515787200000\": 5397.4,\n" +
                "                \"1515789000000\": 81016.8,\n" +
                "                \"1515790800000\": 22435.8,\n" +
                "                \"1515792600000\": 75182.2,\n" +
                "                \"1515794400000\": 60839.6,\n" +
                "                \"1515796200000\": 32066.9,\n" +
                "                \"1515798000000\": 24561,\n" +
                "                \"1515799800000\": 39198.8,\n" +
                "                \"1515801600000\": 48594.3,\n" +
                "                \"1515803400000\": 56258,\n" +
                "                \"1515805200000\": 20924.7,\n" +
                "                \"1515807000000\": 88014.1,\n" +
                "                \"1515808800000\": 81456.7,\n" +
                "                \"1515810600000\": 6233.2,\n" +
                "                \"1515812400000\": 91145.2,\n" +
                "                \"1515814200000\": 75934.7,\n" +
                "                \"1515816000000\": 72459.7,\n" +
                "                \"1515817800000\": 28975.1,\n" +
                "                \"1515819600000\": 14601.2,\n" +
                "                \"1515821400000\": 49910.1,\n" +
                "                \"1515823200000\": 13547.4,\n" +
                "                \"1515825000000\": 95433.2,\n" +
                "                \"1515826800000\": 78039.7,\n" +
                "                \"1515828600000\": 59411.4,\n" +
                "                \"1515830400000\": 78034.8,\n" +
                "                \"1515832200000\": 20636.1,\n" +
                "                \"1515834000000\": 41929.3,\n" +
                "                \"1515835800000\": 69881.9,\n" +
                "                \"1515837600000\": 23024,\n" +
                "                \"1515839400000\": 6710,\n" +
                "                \"1515841200000\": 54233,\n" +
                "                \"1515843000000\": 24679.6,\n" +
                "                \"1515844800000\": 92950,\n" +
                "                \"1515846600000\": 66225.7,\n" +
                "                \"1515848400000\": 25270.1,\n" +
                "                \"1515850200000\": 25434.3,\n" +
                "                \"1515852000000\": 50427.3,\n" +
                "                \"1515853800000\": 8296.1,\n" +
                "                \"1515855600000\": 2340.1\n" +
                "            },\n" +
                "            \"avgUpLinkSpeeds\": {\n" +
                "                \"1515772800000\": 0.165,\n" +
                "                \"1515774600000\": 3.482,\n" +
                "                \"1515776400000\": 64.917,\n" +
                "                \"1515778200000\": 46.959,\n" +
                "                \"1515780000000\": 54.577,\n" +
                "                \"1515781800000\": 32.048,\n" +
                "                \"1515783600000\": 9.527,\n" +
                "                \"1515785400000\": 54.052,\n" +
                "                \"1515787200000\": 73.851,\n" +
                "                \"1515789000000\": 95.379,\n" +
                "                \"1515790800000\": 23.342,\n" +
                "                \"1515792600000\": 53.68,\n" +
                "                \"1515794400000\": 16.165,\n" +
                "                \"1515796200000\": 9.918,\n" +
                "                \"1515798000000\": 74.409,\n" +
                "                \"1515799800000\": 27.477,\n" +
                "                \"1515801600000\": 47.822,\n" +
                "                \"1515803400000\": 83.668,\n" +
                "                \"1515805200000\": 13.488,\n" +
                "                \"1515807000000\": 54.596,\n" +
                "                \"1515808800000\": 26.994,\n" +
                "                \"1515810600000\": 3.387,\n" +
                "                \"1515812400000\": 61.847,\n" +
                "                \"1515814200000\": 60.138,\n" +
                "                \"1515816000000\": 54.457,\n" +
                "                \"1515817800000\": 29.697,\n" +
                "                \"1515819600000\": 11.949,\n" +
                "                \"1515821400000\": 20.527,\n" +
                "                \"1515823200000\": 39.373,\n" +
                "                \"1515825000000\": 54.41,\n" +
                "                \"1515826800000\": 1.591,\n" +
                "                \"1515828600000\": 92.606,\n" +
                "                \"1515830400000\": 53.165,\n" +
                "                \"1515832200000\": 99.364,\n" +
                "                \"1515834000000\": 47.029,\n" +
                "                \"1515835800000\": 58.284,\n" +
                "                \"1515837600000\": 69.532,\n" +
                "                \"1515839400000\": 61.062,\n" +
                "                \"1515841200000\": 45.639,\n" +
                "                \"1515843000000\": 1.497,\n" +
                "                \"1515844800000\": 13.644,\n" +
                "                \"1515846600000\": 30.418,\n" +
                "                \"1515848400000\": 83.667,\n" +
                "                \"1515850200000\": 59.308,\n" +
                "                \"1515852000000\": 68.578,\n" +
                "                \"1515853800000\": 41.903,\n" +
                "                \"1515855600000\": 9.606\n" +
                "            },\n" +
                "            \"avgDownLinkSpeeds\": {\n" +
                "                \"1515772800000\": 52,\n" +
                "                \"1515774600000\": 2.593,\n" +
                "                \"1515776400000\": 12.45,\n" +
                "                \"1515778200000\": 98.505,\n" +
                "                \"1515780000000\": 10.851,\n" +
                "                \"1515781800000\": 53.929,\n" +
                "                \"1515783600000\": 3.886,\n" +
                "                \"1515785400000\": 84.613,\n" +
                "                \"1515787200000\": 42.64,\n" +
                "                \"1515789000000\": 36.193,\n" +
                "                \"1515790800000\": 80.322,\n" +
                "                \"1515792600000\": 14.307,\n" +
                "                \"1515794400000\": 42.875,\n" +
                "                \"1515796200000\": 54.739,\n" +
                "                \"1515798000000\": 13.275,\n" +
                "                \"1515799800000\": 9.838,\n" +
                "                \"1515801600000\": 52.275,\n" +
                "                \"1515803400000\": 54.078,\n" +
                "                \"1515805200000\": 84.709,\n" +
                "                \"1515807000000\": 22.717,\n" +
                "                \"1515808800000\": 21.189,\n" +
                "                \"1515810600000\": 92.85,\n" +
                "                \"1515812400000\": 60.125,\n" +
                "                \"1515814200000\": 96.019,\n" +
                "                \"1515816000000\": 24.467,\n" +
                "                \"1515817800000\": 15.623,\n" +
                "                \"1515819600000\": 31.435,\n" +
                "                \"1515821400000\": 70.973,\n" +
                "                \"1515823200000\": 71.689,\n" +
                "                \"1515825000000\": 22.698,\n" +
                "                \"1515826800000\": 87.035,\n" +
                "                \"1515828600000\": 51.525,\n" +
                "                \"1515830400000\": 82.689,\n" +
                "                \"1515832200000\": 64.095,\n" +
                "                \"1515834000000\": 91.507,\n" +
                "                \"1515835800000\": 65.532,\n" +
                "                \"1515837600000\": 23.29,\n" +
                "                \"1515839400000\": 8.875,\n" +
                "                \"1515841200000\": 82.368,\n" +
                "                \"1515843000000\": 86.27,\n" +
                "                \"1515844800000\": 21.171,\n" +
                "                \"1515846600000\": 65.996,\n" +
                "                \"1515848400000\": 16.285,\n" +
                "                \"1515850200000\": 2.915,\n" +
                "                \"1515852000000\": 6.788,\n" +
                "                \"1515853800000\": 57.85,\n" +
                "                \"1515855600000\": 22.183\n" +
                "            },\n" +
                "            \"upLinkUtilizations\": {\n" +
                "                \"1515772800000\": 0.19,\n" +
                "                \"1515774600000\": 0.1889,\n" +
                "                \"1515776400000\": 0.6252,\n" +
                "                \"1515778200000\": 0.8363,\n" +
                "                \"1515780000000\": 0.761,\n" +
                "                \"1515781800000\": 0.9275,\n" +
                "                \"1515783600000\": 0.4161,\n" +
                "                \"1515785400000\": 0.578,\n" +
                "                \"1515787200000\": 0.6477,\n" +
                "                \"1515789000000\": 0.5607,\n" +
                "                \"1515790800000\": 0.4929,\n" +
                "                \"1515792600000\": 0.8633,\n" +
                "                \"1515794400000\": 0.8497,\n" +
                "                \"1515796200000\": 0.1879,\n" +
                "                \"1515798000000\": 0.061,\n" +
                "                \"1515799800000\": 0.9187,\n" +
                "                \"1515801600000\": 0.8388,\n" +
                "                \"1515803400000\": 0.5756,\n" +
                "                \"1515805200000\": 0.3278,\n" +
                "                \"1515807000000\": 0.8604,\n" +
                "                \"1515808800000\": 0.3681,\n" +
                "                \"1515810600000\": 0.0819,\n" +
                "                \"1515812400000\": 0.3695,\n" +
                "                \"1515814200000\": 0.0202,\n" +
                "                \"1515816000000\": 0.6551,\n" +
                "                \"1515817800000\": 0.1604,\n" +
                "                \"1515819600000\": 0.6729,\n" +
                "                \"1515821400000\": 0.6855,\n" +
                "                \"1515823200000\": 0.107,\n" +
                "                \"1515825000000\": 0.6753,\n" +
                "                \"1515826800000\": 0.6484,\n" +
                "                \"1515828600000\": 0.6088,\n" +
                "                \"1515830400000\": 0.0061,\n" +
                "                \"1515832200000\": 0.5068,\n" +
                "                \"1515834000000\": 0.6548,\n" +
                "                \"1515835800000\": 0.8928,\n" +
                "                \"1515837600000\": 0.8231,\n" +
                "                \"1515839400000\": 0.1786,\n" +
                "                \"1515841200000\": 0.3304,\n" +
                "                \"1515843000000\": 0.1049,\n" +
                "                \"1515844800000\": 0.0758,\n" +
                "                \"1515846600000\": 0.4875,\n" +
                "                \"1515848400000\": 0.2722,\n" +
                "                \"1515850200000\": 0.7291,\n" +
                "                \"1515852000000\": 0.903,\n" +
                "                \"1515853800000\": 0.365,\n" +
                "                \"1515855600000\": 0.3575\n" +
                "            },\n" +
                "            \"downLinkUtilizations\": {\n" +
                "                \"1515772800000\": 0.4934,\n" +
                "                \"1515774600000\": 0.6485,\n" +
                "                \"1515776400000\": 0.6107,\n" +
                "                \"1515778200000\": 0.3337,\n" +
                "                \"1515780000000\": 0.4658,\n" +
                "                \"1515781800000\": 0.1152,\n" +
                "                \"1515783600000\": 0.342,\n" +
                "                \"1515785400000\": 0.566,\n" +
                "                \"1515787200000\": 0.5991,\n" +
                "                \"1515789000000\": 0.0407,\n" +
                "                \"1515790800000\": 0.2711,\n" +
                "                \"1515792600000\": 0.8244,\n" +
                "                \"1515794400000\": 0.0567,\n" +
                "                \"1515796200000\": 0.4328,\n" +
                "                \"1515798000000\": 0.5643,\n" +
                "                \"1515799800000\": 0.1244,\n" +
                "                \"1515801600000\": 0.6564,\n" +
                "                \"1515803400000\": 0.9684,\n" +
                "                \"1515805200000\": 0.5704,\n" +
                "                \"1515807000000\": 0.4354,\n" +
                "                \"1515808800000\": 0.163,\n" +
                "                \"1515810600000\": 0.4511,\n" +
                "                \"1515812400000\": 0.1425,\n" +
                "                \"1515814200000\": 0.1643,\n" +
                "                \"1515816000000\": 0.5164,\n" +
                "                \"1515817800000\": 0.3384,\n" +
                "                \"1515819600000\": 0.6808,\n" +
                "                \"1515821400000\": 0.2773,\n" +
                "                \"1515823200000\": 0.6308,\n" +
                "                \"1515825000000\": 0.5395,\n" +
                "                \"1515826800000\": 0.6601,\n" +
                "                \"1515828600000\": 0.3857,\n" +
                "                \"1515830400000\": 0.6529,\n" +
                "                \"1515832200000\": 0.9328,\n" +
                "                \"1515834000000\": 0.653,\n" +
                "                \"1515835800000\": 0.3695,\n" +
                "                \"1515837600000\": 0.8149,\n" +
                "                \"1515839400000\": 0.3013,\n" +
                "                \"1515841200000\": 0.11,\n" +
                "                \"1515843000000\": 0.3624,\n" +
                "                \"1515844800000\": 0.2706,\n" +
                "                \"1515846600000\": 0.6358,\n" +
                "                \"1515848400000\": 0.4094,\n" +
                "                \"1515850200000\": 0.1733,\n" +
                "                \"1515852000000\": 0.5488,\n" +
                "                \"1515853800000\": 0.0058,\n" +
                "                \"1515855600000\": 0.9371\n" +
                "            }\n" +
                "        }\n" +
                "    }\n" +
                "}";
        BroadbandlinesBean broadbandlinesBean=new Gson().fromJson(ret, BroadbandlinesBean.class);
        tv.setText(broadbandlinesBean.toString());
    }

    private void requestLogin() {
        ThreadManager.getThreadManager().submit(new Runnable() {
            @Override
            public void run() {
                Login login = netManager.post(BuildConfig.API_HOST + "/account/account/v1/login", createLogin(), Login.class);
                if (null != login)
                    handler.obtainMessage(LOGIN, login).sendToTarget();
                else
                    handler.obtainMessage(EMPTY_RESPONSE).sendToTarget();
            }
        });
    }

    private Map<String, Object> createLogin() {
        Map<String, Object> params = new HashMap<String, Object>();
        params.put("username", "aaa.@google.com");
        params.put("password", "sfddfecvwewe");
        params.put("loginType", "EM");
        return params;
    }

    private void requestRegion() {

        ThreadManager.getThreadManager().submit(new Runnable() {
            @Override
            public void run() {
                RegionList regionList = netManager.get(BuildConfig.API_HOST + "/sysmgmt/sysmgmt/v1/dictionaries/DIC_CM_COUNTRY/zh-CN", RegionList.class);
                if (null != regionList)
                    handler.obtainMessage(REGION_LIST, regionList).sendToTarget();
                else
                    handler.obtainMessage(EMPTY_RESPONSE).sendToTarget();
            }
        });
    }

    private void request() {

        ThreadManager.getThreadManager().submit(new Runnable() {
            @Override
            public void run() {
                UnReadMsg unReadMsg = netManager.post(BuildConfig.API_HOST + "/notification/notification/v1/notifications/query", createParams(), UnReadMsg.class);
                if (null != unReadMsg)
                    handler.obtainMessage(UNREAD_MSG, unReadMsg).sendToTarget();
                else
                    handler.obtainMessage(EMPTY_RESPONSE).sendToTarget();
            }
        });

    }

    private Map<String, Object> createParams() {
        Map<String, Object> params = new HashMap<String, Object>();
        params.put("unifyID", "110001");
        params.put("serviceType", "11");
        params.put("notifyType", "0");
        params.put("receiver", "18012989588");
        params.put("noticeStatus", "1");
        params.put("readStatus", "1");
        return params;
    }
}
